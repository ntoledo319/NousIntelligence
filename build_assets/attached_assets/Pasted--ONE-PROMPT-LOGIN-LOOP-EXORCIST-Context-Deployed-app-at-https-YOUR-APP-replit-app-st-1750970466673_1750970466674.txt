ü™ì  ONE-PROMPT LOGIN-LOOP EXORCIST  ü™ì
Context:
  ‚Ä¢ Deployed app at https://<YOUR-APP>.replit.app still shows ‚ÄúYou must be logged in‚Äù.
  ‚Ä¢ Agent **cannot** edit `.replit`; all fixes must happen in application code & config files.

Tasks:

1. INVENTORY
   ‚Ä¢ Scan for (`trust proxy`, `ProxyFix`, `SECURE_PROXY_SSL_HEADER`, `SameSite`, `secure:`, `ensureAuth`, `.env`, `process.env`, `.env.example`, `NEXTAUTH_URL`, `redirect_uri`).
   ‚Ä¢ List duplicate config files (`next.config.*`, `vite.config.*`, auth configs) and outdated landing pages.

2. PROXY & COOKIE PATCH
   ‚Ä¢ If Express/Koa/Fastify ‚áí insert `app.set('trust proxy', 1)` before sessions.
   ‚Ä¢ Flask ‚áí wrap with `ProxyFix(x_for=1, x_proto=1)`.
   ‚Ä¢ Django ‚áí add `SECURE_PROXY_SSL_HEADER = ("HTTP_X_FORWARDED_PROTO","https")`.
   ‚Ä¢ Harden cookies: `{ httpOnly:true, sameSite:"lax", secure:process.env.NODE_ENV==="production" }`.
   ‚Ä¢ For cross-site OAuth flows, force `SameSite:"None"` **and** `secure:true`.

3. AUTH-PROVIDER SANITY
   ‚Ä¢ Replace hard-coded `localhost`/port callbacks with `<YOUR-APP>.replit.app`.
   ‚Ä¢ Pull these URLs from `process.env` or framework settings; if missing, generate keys and add to Secrets (do **not** commit sensitive values).

4. CSRF & SESSION
   ‚Ä¢ Ensure one session store (Redis/Prisma/DB/file); remove duplicate or test stores.
   ‚Ä¢ Sync CSRF middleware with that store and add logging on 403.

5. SPA & ROUTER
   ‚Ä¢ Add server-side catch-all route (`*`) that sends `index.html`.
   ‚Ä¢ If React/Vite, ensure `BrowserRouter` uses `basename="/"` and `fetch` calls include `{ credentials:"include" }`.

6. REPO DIET
   ‚Ä¢ Delete duplicate landing pages, obsolete `.html` copies, stale migrations, extra lockfiles, unused images.
   ‚Ä¢ Keep only one `index.html` in the public directory.

7. TEST SUITE
   ‚Ä¢ Create `tests/loginLoop.spec.(js|py|rb)`:
       - GET / ‚áí expect 200
       - GET /dashboard unauth ‚áí expect 302 ‚Üí /login
       - POST /api/login (fixture creds) ‚áí expect 200 + Set-Cookie
       - GET /dashboard with cookie ‚áí expect 200
   ‚Ä¢ Add npm/pip script `test:smoke` that runs this suite.

8. DEPLOY & VERIFY
   ‚Ä¢ Commit ‚Äúfix: proxy+cookie+auth loop‚Äù.
   ‚Ä¢ Trigger Replit Deployment preview.
   ‚Ä¢ Run smoke tests; if any fail, abort the commit and print errors.

Output:
   ‚Ä¢ Diff summary (files changed/removed/added)
   ‚Ä¢ List of new env vars to add in Secrets
   ‚Ä¢ Smoke-test results

Constraints:
   ‚Ä¢ **Do NOT touch `.replit`**.
   ‚Ä¢ No new packages unless absolutely necessary.
   ‚Ä¢ Comment every assumption; leave breadcrumbs for humans.

üî•  END PROMPT ‚Äî slice, dice, deploy, rejoice. üî•