üö®  REPO SHERLOCK + AUTH EXORCIST üö®
Objective:
  ‚Ä¢ The deployed app at https://<YOUR-APP>.replit.app loops to ‚ÄúYou must be logged in‚Ä¶‚Äù.
  ‚Ä¢ Kill *all* root causes, clean the repo, and guarantee the loop can‚Äôt re-emerge.

Global Rules:
  1. **Never duplicate**: merge configs, delete zombies, create a new file only if no sane file exists.
  2. **Cross-stack**: autodetect Node (Express, Next.js, Remix, Astro, SvelteKit, Redwood), Python (Django, Flask, FastAPI), Ruby (Rails, Sinatra), PHP (Laravel).
  3. **Write comments** every time you assume intent.
  4. **Errors halt**: if any test fails, abort the commit & print the error.

Step-by-step:

1. INVENTORY
   ‚Ä¢ List every env var referenced; cross-check Replit Secrets. Stub or create missing ones.
   ‚Ä¢ Locate auth guards: regex for `requireLogin|ensureAuth|withAuth|@login_required|authenticate_user!`.
   ‚Ä¢ Identify cookie/session configs and duplicate config files.

2. PROXY PATCHES
   ‚Ä¢ If Express/Fastify etc. ‚áí `app.set('trust proxy', 1)` and secure cookies `{ secure: NODE_ENV==='production', sameSite:'lax' }`.
   ‚Ä¢ If Django ‚áí add `SECURE_PROXY_SSL_HEADER` and `SESSION_COOKIE_SECURE = True`.
   ‚Ä¢ If Flask ‚áí wrap with `ProxyFix(x_for=1, x_proto=1)`.
   ‚Ä¢ If Rails ‚áí `config.action_dispatch.trusted_proxies = ["0.0.0.0/0"]` and `config.force_ssl = true`.

3. COOKIE HARDENING
   ‚Ä¢ Any cookie used for auth must be `httpOnly`, `SameSite=Lax` (or `None;Secure` for cross-site), `secure` in prod.

4. AUTH-PROVIDER SANITY
   ‚Ä¢ Normalise all callback / base URLs (NextAuth `NEXTAUTH_URL`, Auth0 `AUTH0_BASE_URL`, Firebase `authDomain`, Supabase `NEXT_PUBLIC_SUPABASE_URL`, etc.) to the deployed domain.
   ‚Ä¢ Remove hard-coded `localhost` and port references.

5. SPA REFRESH FIXES
   ‚Ä¢ Detect React/Vite/SvelteKit builds. If no rewrite config, generate `_redirects` (Netlify style) or `vercel.json` or `static.json` (Fly.io style):
       /*    /index.html   200

6. ROUTE GUARD TUNING
   ‚Ä¢ Replace blanket middleware with granular guards:
       Public: `/`, `/login`, `/signup`, `/api/health`, static assets
       Protected: everything else
   ‚Ä¢ Export a reusable `isAuthenticated()` (Node) or `login_required` (Python) and import where needed.

7. REPO DETOX
   ‚Ä¢ Delete: duplicate lockfiles, obsolete migrations, sample code, `.idea/`, `.vscode/`, `.DS_Store`, unused images, old build output, etc.
   ‚Ä¢ Merge identical configs; keep the newest.

8. TEST SUITE
   ‚Ä¢ Add `/tests/auth-loop.spec.js` (or Python/RSpec equivalent) with cURL or supertest checks:
       - GET / ‚áí 200
       - GET /dashboard unauth ‚áí 302 ‚Üí /login
       - POST /api/login with fixture creds ‚áí 200
       - GET /dashboard after session ‚áí 200
   ‚Ä¢ Include an npm/pip script `test:smoke` that runs these.

9. GIT & DEPLOY
   ‚Ä¢ Commit with message: ‚Äúchore: auth-loop nuke + repo diet‚Äù.
   ‚Ä¢ Tag `post-auth-loop-fix`.
   ‚Ä¢ Trigger fresh Replit Deployment.

10. ROLLBACK PLAN
   ‚Ä¢ If smoke tests redline, run `git reset --hard pre-auth-loop-nuke` and redeploy.

Output:
  ‚Ä¢ Diff summary of files changed/added/removed.
  ‚Ä¢ List of new env vars to add in Replit Secrets UI.
  ‚Ä¢ Smoke-test results table.

‚ö°  End of prompt ‚Äî pull the pin and run.