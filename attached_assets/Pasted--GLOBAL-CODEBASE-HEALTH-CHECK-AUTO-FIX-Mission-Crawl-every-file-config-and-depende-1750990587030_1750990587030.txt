ðŸš‘  GLOBAL CODEBASE HEALTH-CHECK & AUTO-FIX  ðŸš‘

Mission:
   â€¢ Crawl every file, config, and dependency in this Replit repo.
   â€¢ Identify and AUTOMATICALLY fix or propose fixes for ALL classes of problems that trigger login loops, runtime crashes, security holes, style drift, or deployment failures.
   â€¢ Leave detailed, commented commits; abort if smoke tests fail.

Core Rules:
   1. **No .replit edits** (platform restriction)â€”conform to its current `run` command.
   2. Create new files ONLY when consolidation is impossible; otherwise refactor in place.
   3. All secrets must be read from Replit Secrets.
   4. Every code change must pass lint, type-check, unit tests, AND new smoke tests.
   5. Commit messages follow Conventional Commits.

================================================================================
STEP 0 â€” INVENTORY & BASELINE
--------------------------------------------------------------------------------
â€¢ Parse repo for:
    - Duplicate configs (`.replit`, `Procfile`, `Dockerfile`, `replit.workflows`)
    - Auth middleware, cookie options, CSRF settings
    - `process.env` / `os.getenv` usages â†’ verify in Secrets
    - Dependencies with known CVEs (call `npm audit` / `pip-audit`)
    - Lint/format configs; TypeScript strictness; Python type hints
â€¢ Generate a markdown report of findings.

================================================================================
STEP 1 â€” PROXY & COOKIE HARDENING
--------------------------------------------------------------------------------
â€¢ Node/Express/Fastify â†’ add `app.set('trust proxy', 1);`
â€¢ Flask â†’ wrap app in `ProxyFix(x_for=1, x_proto=1)`
â€¢ Django â†’ `SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')`
â€¢ Force cookies `{ httpOnly:true, sameSite:'lax', secure:prod }`
â€¢ For cross-site OAuth cookies â†’ `SameSite:'None'; secure:true`

================================================================================
STEP 2 â€” SECRETS & ENV-VAR SYNC
--------------------------------------------------------------------------------
â€¢ List every env-var reference; prompt user if missing from Secrets.
â€¢ Delete `.env` files (Replit ignores them in Deployment anyway) and add `.env.example`.

================================================================================
STEP 3 â€” DEPENDENCY & STATIC ANALYSIS
--------------------------------------------------------------------------------
â€¢ Run `npm audit --json` or `pip-audit -f json`; auto-upgrade patch-level vulnerabilities.
â€¢ Apply ESLint + Prettier or `ruff` (Py) with recommended rules.
â€¢ If TypeScript present, enable `"strict": true` in `tsconfig.json`.

================================================================================
STEP 4 â€” DUPLICATE & DEAD CODE PURGE
--------------------------------------------------------------------------------
â€¢ Hash-scan for duplicate files (`fdupes`-style).
â€¢ Remove stale builds, old migrations, unused images, commented-out code blocks.

================================================================================
STEP 5 â€” SPA ROUTER SAFETY
--------------------------------------------------------------------------------
â€¢ If React/Vite/SvelteKit detected and no `_redirects` file exists, create:
      /*   /index.html   200
  to stop hard-refresh 404 â†’ auth loops.

================================================================================
STEP 6 â€” TEST GRID
--------------------------------------------------------------------------------
â€¢ Auto-generate Jest/PyTest smoke suite:
      1. GET /          â‡’ 200
      2. GET /dashboard â‡’ 302â†’/login
      3. POST /api/login (fixture) â‡’ 200 + Set-Cookie
      4. Auth GET /dashboard â‡’ 200
â€¢ Fail CI if any test fails.

================================================================================
STEP 7 â€” WORKFLOW CONSOLIDATION
--------------------------------------------------------------------------------
â€¢ Keep ONE `replit.workflows` named `build-and-run`:
      - Install deps
      - Run lint + tests
      - Start server
â€¢ Delete extra workflows or launch files.

================================================================================
STEP 8 â€” COMMIT & DEPLOY
--------------------------------------------------------------------------------
â€¢ Commit in chunks (`fix(proxy)`, `chore(lint)`, `refactor(routes)`, etc.).
â€¢ Tag `post-universal-fix`.
â€¢ Trigger new Deployment; stream logs and test endpoints.

================================================================================
FAIL-SAFE
--------------------------------------------------------------------------------
â€¢ If Deployment or tests fail, `git reset --hard post-inventory` and exit non-zero.

================================================================================
END â€” print:
   â€¢ Fix summary + next steps for any unresolved issues
   â€¢ Secrets to add
   â€¢ Deployment URL