ğŸš‘  GLOBAL PORT SANITIZER & DEPLOY FIX  ğŸš‘
Objective:  â€¢ Detect every hard-coded port or conflicting listen() call.
            â€¢ Standardize ALL runtime servers to PORT = process.env.PORT || 5000.
            â€¢ Ensure .replit, workflows, Docker/Procfile, env files, front-end dev servers, and test suites respect this value.
            â€¢ Abort deploy if smoke tests detect a rogue port.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 0 â€” PORT CRAWL & INVENTORY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Grep the entire repo (case-insensitive) for regex `\\b(80|3000|3001|3002|5000|5001|8000|8080|9000)\\b`
  and for common listen patterns:
     - `app.listen(`, `server.listen(`, `flask.run`, `uvicorn.*--port`, `runserver`, `createServer(`
â€¢ Build **ports_report.md** listing:
     â€¢ File path + line number
     â€¢ Port number found
     â€¢ Suggested replacement (PORT or 5000)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 1 â€” CODE PATCHES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ **Node / Express / Fastify**
     Replace any `app.listen(<number>` with:

        const port = process.env.PORT ? parseInt(process.env.PORT) : 5000;
        app.listen(port, "0.0.0.0", () => console.log(`Listening on ${port}`));

â€¢ **Flask**
     Ensure entry point uses:  
        port = int(os.environ.get("PORT", 5000))
        app.run(host="0.0.0.0", port=port)

â€¢ **Django manage.py / runserver**
     Default to `os.environ.get("PORT", "5000")`.

â€¢ **React / Vite / Front-end dev servers**
     Add `.env.development` â†’ `PORT=5000`
     Document that CRA will fallback to next free port locally but CI must export PORT.

â€¢ **Docker / Procfile / gunicorn**
     Replace hard-codes (`CMD ["gunicorn", "-b", ":8080" â€¦]`) with `":$PORT"`.

â€¢ **replit.workflows**
     Keep ONE workflow; add `export PORT=5000` before `npm start` / `python app.py`.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 2 â€” PROXY & COOKIE SAFETY (retain if already patched)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Node: `app.set("trust proxy", 1);`  // keeps Secure cookies alive. [oai_citation:7â€¡expressjs.com](https://expressjs.com/en/guide/migrating-4.html?utm_source=chatgpt.com)
â€¢ Flask: `from werkzeug.middleware.proxy_fix import ProxyFix` â€¦ `app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1, x_proto=1)`.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 3 â€” SMOKE-TEST GRID (tests/ports.spec.js or .py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Assert ENV `PORT` defaults to 5000 in absence of override.
2. Spin server, `curl http://127.0.0.1:$PORT/health` â‡’ 200.
3. Spawn secondary process on 5001 and assert primary still answers.
4. Run `lsof -i -P -n | grep LISTEN` inside Deployment VM; fail if any LISTEN â‰  $PORT.

Add npm script or pytest marker `test:ports`.  
Fail commit if tests fail.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 4 â€” COMMIT, TAG, DEPLOY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Commit with Conventional Commits:
     - `refactor(port): unify to $PORT||5000`
â€¢ Tag `port-fix-$(date +%Y%m%d)`.
â€¢ Trigger Deployment, tail 60 s logs; if `$PORT` not echoed, abort.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
OUTPUT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ”ï¸  Updated files list  
âœ”ï¸  ports_report.md diff  
âœ”ï¸  Secrets still required (if any)  
âœ”ï¸  Smoke-test results  
âœ”ï¸  Deploy URL

ğŸ”«  EXECUTE.  Any service not listening on $PORT after this gets shot on sight. ğŸ”«