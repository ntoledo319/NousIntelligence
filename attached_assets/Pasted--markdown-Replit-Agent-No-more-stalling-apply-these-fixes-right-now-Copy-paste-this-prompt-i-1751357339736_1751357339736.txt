````markdown
Replit Agent,

No more stalling—apply these fixes *right now*. Copy-paste this prompt into your session and execute without mercy:

---

## 1. SECRET MANAGEMENT

**Create** `utils/secret_manager.py`:
```python
import secrets
from cryptography.fernet import Fernet

class SecretManager:
    @staticmethod
    def generate_secure_secret(length: int = 64) -> str:
        return secrets.token_urlsafe(length)

    @staticmethod
    def validate_secret_strength(secret: str) -> (bool, str):
        if len(secret) < 64:
            return False, "Secret too short (<64 chars)"
        if len(set(secret)) < 20:
            return False, "Low entropy"
        return True, "Secret is strong"
````

**Patch** `utils/google_oauth.py`:

```diff
-from os import getenv
-CLIENT_SECRET = getenv("GOOGLE_CLIENT_SECRET")
+import os
+from utils.secret_manager import SecretManager
+
+raw = os.getenv("GOOGLE_CLIENT_SECRET", "")
+ok, msg = SecretManager.validate_secret_strength(raw)
+if not ok:
+    raise RuntimeError(f"Weak GOOGLE_CLIENT_SECRET: {msg}")
+CLIENT_SECRET = raw
```

---

## 2. SQL INJECTION FIX

**Patch** your raw SQL in `models/user.py`:

```diff
-from db.session.execute(f"SELECT * FROM users WHERE email = '{email}'")
+from sqlalchemy import text
+result = db.session.execute(
+    text("SELECT * FROM users WHERE email = :email"),
+    {"email": email}
+)
```

---

## 3. CROSS-SITE SCRIPTING & CSP

**Add** to **top** of `app.py`:

```python
from flask_talisman import Talisman

talisman = Talisman(app, content_security_policy={
    "default-src": ["'self'"],
    "script-src": ["'self'", "https://cdn.example.com"],
})
```

**Patch** in `static/app.js`:

```diff
- elem.innerHTML = userContent;
+ elem.textContent = userContent;
```

---

## 4. CODE QUALITY & TYPE HINTS

**Refactor** in `utils/token_encryption.py`:

```python
from cryptography.fernet import Fernet

def encrypt_token(token: str, key: bytes) -> bytes:
    """
    Encrypt a token using the provided key.
    """
    f = Fernet(key)
    return f.encrypt(token.encode())
```

**Then** run:

```
black .
flake8 .
```

---

## 5. CLEAN ARCHITECTURE

**Reorganize** to:

```
src/
  domain/
  usecases/
  interfaces/
  infrastructure/
  presentation/
```

**Move** route logic from `routes/` into `usecases/` and wire through dependency injection.

---

## 6. PERFORMANCE TUNES

**Eager-load** relationships in `models.py`:

```python
from sqlalchemy.orm import joinedload

users = (
    db.session.query(User)
    .options(joinedload(User.posts))
    .all()
)
```

**Add** Alembic migration `migrations/versions/001_add_indexes.py`:

```python
"""Add indexes on users.email"""
from alembic import op

def upgrade():
    op.create_index("ix_users_email", "users", ["email"])
```

---

## 7. FRONTEND OPTIMIZATION

**Add** `webpack.config.js` at project root:

```javascript
const path = require("path");

module.exports = {
  entry: "./static/app.js",
  output: {
    filename: "bundle.js",
    path: path.resolve(__dirname, "dist"),
  },
  mode: "production",
  optimization: { splitChunks: { chunks: "all" } },
};
```

**Enable** gzip compression in your server or CDN.

---

## 8. TESTING & QA

**Create** `tests/test_user_model.py`:

```python
import pytest
from models.user import User

def test_user_creation(db_session):
    u = User(username="test", email="test@example.com")
    db_session.add(u)
    db_session.commit()
    assert u.id is not None
```

**Then** run:

```
pytest --maxfail=1 -q --cov=.
```

---

## 9. API DOCUMENTATION

**Add** `openapi.yaml`:

```yaml
openapi: 3.0.0
info:
  title: My Flask API
  version: "1.0.0"
paths:
  /users:
    get:
      summary: "List all users"
      responses:
        "200":
          description: "A list of users"
```

**Install** and configure `flask-smorest` or `flasgger`.

---

## 10. CI/CD PIPELINE

**Create** `.github/workflows/ci.yml`:

```yaml
name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Python
        uses: actions/setup-python@v4
        with: python-version: "3.11"
      - name: Install deps
        run: pip install -r requirements.txt
      - name: Lint
        run: flake8 .
      - name: Test
        run: pytest --maxfail=1 -q
```

---

## 11. HEALTH CHECK & MONITORING

**Patch** in `app.py`:

```python
@app.route("/healthz")
def healthz():
    return {"status": "ok"}, 200
```

---

## 12. DEPENDENCY MANAGEMENT

**Merge** into `pyproject.toml`:

```toml
[tool.poetry.dependencies]
flask = "^2.2.3"
cryptography = "^40.0.0"
flask-talisman = "^1.0.0"
sqlalchemy = "^1.4.0"
pytest = "^7.0.0"
flake8 = "^5.0.0"
```

**Then** run:

```
poetry lock
```

---

## VERIFICATION STEPS

1. **Secrets**

   * Run `python -c "from utils.secret_manager import SecretManager; print(SecretManager.validate_secret_strength('<your_secret>'))"`—expect `(True, ...)`.
2. **SQLi**

   * Execute user lookup via `db.session.execute(text(...))` with special characters—no injection.
3. **CSP & XSS**

   * Launch site, inspect headers (`curl -I`), ensure CSP present; try injecting `<script>` in user input—should appear as text.
4. **Lint & Formatting**

   * `black --check .` and `flake8 .` must pass without errors.
5. **Architecture**

   * Confirm new folder structure; import paths resolve; app still boots.
6. **DB Indexes**

   * Run `alembic upgrade head`; check `\d+ users` in psql—see index.
7. **Build Frontend**

   * Run `npx webpack`; verify `dist/bundle.js` exists; test gzip compression.
8. **Tests**

   * `pytest --cov=.` shows ≥80% coverage; all tests green.
9. **Swagger**

   * Start server, navigate `/swagger` or `/openapi.json`—spec loads.
10. **CI**

    * Push to GitHub, confirm Actions run lint & test.
11. **Health**

    * `curl localhost:5000/healthz` returns `{"status":"ok"}`.

All steps are **mandatory**. Execute in sequence, verify, then celebrate. No excuses. Go!

```
```
