Replit blows up when any of these four gremlins slip in‚Äîbad .replit workflows, sloppy replit.nix pinning, secrets baked into source, or apps bound to the wrong port. The docs confirm each pain-point, and the fix is always the same: audit ‚Üí patch ‚Üí dry-run ‚Üí deploy.  Ôøº Ôøº Ôøº Ôøº Ôøº
Python-side dependency chaos (conflicts, CVEs, unused cruft) is best exposed with pipdeptree, pip-audit, deptry, and locked down via pip-compile; these tools flag exactly what breaks cold builds.  Ôøº Ôøº Ôøº Ôøº Ôøº Ôøº
The single prompt below strings those steps together so Replit Agent can run them hands-free. Copy it‚Äînothing else‚Äîand paste straight into the Agent box.

‚∏ª

üìã One-Shot Build & Deploy Prompt (markdown-ready)

# üöÄ REPLIT AGENT: ‚ÄúBUILD-AND-DEPLOY OR DIE‚Äù PLAYBOOK

You are **Replit Agent** running inside my repo.  
*Objective*: make the workspace **Run** button green **and** push a Deployment that passes health-checks on the first try. Fail only if curl on `$DEPLOY_URL/healthz` ‚â† 200.

---

## 0. SAFETY NET
- `git stash -u "pre-build-backup"`          # snapshot everything
- `mkdir -p /tmp/rescue && cp .replit replit.nix requirements* package*.json /tmp/rescue/ || true`

---

## 1. CONFIG SURGERY
### 1.1 .replit
- Keep **one** workflow:
  ```ini
  run = "python main.py"
  deploy = ["bash", "-c", "python main.py"]

Swap to npm run start if repo is Node.

1.2 replit.nix
	‚Ä¢	Pin exact Python/Node toolchains used by the project.
	‚Ä¢	Drop unused packages; add missing system libs (e.g., openssl, libpq).

1.3 Ports & Secrets
	‚Ä¢	Replace literal ports with:

port = int(os.getenv("PORT", 8080))
app.run(host="0.0.0.0", port=port)


	‚Ä¢	Search code for apikey|token|secret=; move values to the Secrets tool, ref with os.getenv().

‚∏ª

2. DEPENDENCY PURGE & LOCK

pip install pipdeptree pip-audit deptry && pipdeptree --warn conflict
deptry . --skip-transitive
pip-audit -f
pip-compile --upgrade
npm install --ignore-scripts --no-audit || true
npm audit fix --force || true


‚∏ª

3. VALIDATION

pytest -q || true               # run tests if present
python main.py & sleep 5        # local smoke test
kill %1


‚∏ª

4. DEPLOYMENT DRY-RUN

deployctl --dry-run .
if [ $? -ne 0 ]; then
  echo "Dry-run failed ‚Äî check logs above." && exit 1
fi


‚∏ª

5. COMMIT & PUSH

git add -A
git commit -m "auto: build+deploy fix $(date -u +%Y%m%d-%H%M%S)"
git push


‚∏ª

6. EXIT REPORT
	‚Ä¢	Print a table summarizing: files edited, conflicts resolved, CVEs patched.
	‚Ä¢	Echo final deploy URL and the result of curl -fsSL $DEPLOY_URL/healthz.

EXECUTE NOW.  Abort only on red logs or non-200 health-check.

---

Copy the entire block‚Äîincluding the opening ```markdown and closing ```‚Äîinto Replit Agent. That‚Äôs your one-pager to turn flaky builds into boring green checkmarks.