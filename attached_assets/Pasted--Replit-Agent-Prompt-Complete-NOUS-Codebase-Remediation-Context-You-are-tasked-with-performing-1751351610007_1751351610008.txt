# Replit Agent Prompt: Complete NOUS Codebase Remediation

## Context
You are tasked with performing a complete remediation of the NOUS personal assistant codebase based on the comprehensive audit report below. Your mission is to fix ALL identified issues with 100% coverage and implement verification systems to ensure all fixes are properly applied and tested.

## Audit Report Summary
[Include the full audit report from the previous message here]

## Your Mission: Complete Codebase Remediation

### Phase 1: Critical Security Fixes (IMMEDIATE)

1. **Fix All Hardcoded Credentials**
   - Search for ALL hardcoded secrets, API keys, and credentials
   - Move ALL sensitive data to environment variables
   - Implement proper secret management using python-dotenv
   - Create a secrets validation script that verifies no hardcoded credentials exist
   - Encrypt all sensitive data in database using cryptography library
   - Verification: Create `verify_no_secrets.py` that scans entire codebase

2. **Eliminate SQL Injection Vulnerabilities**
   - Replace ALL string concatenation in SQL queries with parameterized queries
   - Use SQLAlchemy ORM exclusively - no raw SQL
   - Implement query builders with proper escaping
   - Add SQL injection tests for all database operations
   - Verification: Create `verify_sql_security.py` that tests all queries

3. **Fix Authentication System**
   - Remove duplicate auth implementations (keep only one JWT implementation)
   - Implement proper RBAC with user roles and permissions
   - Secure all endpoints with proper authentication decorators
   - Fix OAuth implementation and test with real Google OAuth
   - Remove demo mode security bypasses
   - Verification: Create `verify_authentication.py` that tests all endpoints

4. **Input Validation & Sanitization**
   - Implement input validation for EVERY API endpoint
   - Use marshmallow or pydantic for request/response validation
   - Sanitize all user inputs before storage or display
   - Implement rate limiting on all endpoints
   - Verification: Create `verify_input_validation.py`

### Phase 2: Architecture Cleanup

1. **Consolidate Entry Points**
   - Delete `app_working.py` and consolidate into `app.py`
   - Update `main.py` to import from `app`
   - Remove all duplicate implementations
   - Create clear application factory pattern
   - Verification: Ensure single entry point works

2. **Fix Circular Dependencies**
   - Remove ALL wildcard imports
   - Implement proper import structure
   - Create clear module hierarchy
   - Use dependency injection pattern
   - Verification: Create `verify_imports.py` that checks for circular deps

3. **Clean Code Structure**
   - Organize utils/ directory into logical submodules
   - Remove all duplicate code
   - Delete archive/ and backup directories
   - Implement proper service layer pattern
   - Verification: Create module dependency graph

### Phase 3: Code Quality Improvements

1. **Fix Error Handling**
   - Replace ALL bare except clauses with specific exceptions
   - Implement proper logging for all errors
   - Create custom exception classes
   - Implement error recovery strategies
   - Verification: Create `verify_error_handling.py`

2. **Remove Dangerous Functions**
   - Replace ALL subprocess calls with safe alternatives
   - Remove ALL eval() and exec() usage
   - Replace os.system() with subprocess.run() with proper sanitization
   - Remove dynamic imports
   - Verification: Create `verify_no_dangerous_functions.py`

3. **Implement Comprehensive Testing**
   - Create unit tests for ALL functions (100% coverage)
   - Add integration tests for all API endpoints
   - Implement end-to-end tests for critical user flows
   - Set up pytest with coverage reporting
   - Verification: Achieve minimum 80% code coverage

### Phase 4: Performance & Scalability

1. **Database Optimization**
   - Add indexes to all foreign keys and frequently queried fields
   - Implement query optimization
   - Add connection pooling
   - Implement caching strategy with Redis
   - Verification: Create performance benchmarks

2. **API Optimization**
   - Implement pagination for all list endpoints
   - Add response compression
   - Implement proper caching headers
   - Optimize static asset delivery
   - Verification: Load test all endpoints

### Phase 5: Deployment & Operations

1. **Configuration Management**
   - Remove ALL hardcoded URLs and ports
   - Implement proper configuration classes
   - Create environment-specific configs
   - Document all environment variables
   - Verification: Test in multiple environments

2. **Logging & Monitoring**
   - Implement structured logging with JSON format
   - Add request ID tracking
   - Create health check endpoints
   - Implement application metrics
   - Verification: Create monitoring dashboard

### Phase 6: Documentation & Cleanup

1. **Complete Documentation**
   - Add docstrings to ALL functions and classes
   - Create API documentation with OpenAPI/Swagger
   - Write comprehensive README
   - Create architecture diagrams
   - Verification: Generate documentation site

2. **Final Cleanup**
   - Remove all TODO/FIXME comments (fix them instead)
   - Delete all unused code
   - Run code formatters (black, isort)
   - Run linters (flake8, pylint)
   - Verification: Zero linter warnings

## Implementation Instructions

1. **Create a new branch**: `fix/complete-remediation`

2. **Work in phases**: Complete each phase fully before moving to next

3. **For EACH fix**:
   - Write the fix
   - Write tests for the fix
   - Write verification script
   - Document the change
   - Commit with descriptive message

4. **Verification Requirements**:
   - Create `verification/` directory
   - Add verification script for each major fix
   - Create master verification script `verify_all.py` that runs all checks
   - ALL verification scripts must pass before completion

5. **Testing Requirements**:
   - Minimum 80% code coverage
   - All tests must pass
   - No security vulnerabilities in dependencies
   - Performance benchmarks must meet targets

6. **Documentation Requirements**:
   - Every public function must have docstring
   - API documentation must be complete
   - README must accurately describe project
   - CHANGELOG must document all fixes

## Acceptance Criteria

The remediation is complete when:

1. **Security**: 
   - Zero hardcoded credentials
   - Zero SQL injection vulnerabilities  
   - All endpoints properly authenticated
   - All inputs validated and sanitized

2. **Code Quality**:
   - Zero bare except clauses
   - Zero dangerous function usage
   - 80%+ test coverage
   - Zero linter warnings

3. **Architecture**:
   - Single application entry point
   - No circular dependencies
   - Clean module structure
   - No duplicate code

4. **Performance**:
   - All queries optimized with indexes
   - Response times < 200ms for all endpoints
   - Memory usage stable under load
   - Proper caching implemented

5. **Operations**:
   - Comprehensive logging
   - Health checks passing
   - Monitoring in place
   - Deployment documented

6. **Verification**:
   - All verification scripts passing
   - All tests passing
   - Documentation complete
   - Code review approved

## Start Immediately

Begin with Phase 1 security fixes as these are CRITICAL. Create the verification infrastructure first, then systematically fix each issue. Document everything. Test everything. Verify everything.

Your success will be measured by:
- 100% of identified issues fixed
- 100% verification coverage
- 0 security vulnerabilities
- 80%+ test coverage
- Clean, maintainable codebase

Begin now with the security fixes. Good luck!