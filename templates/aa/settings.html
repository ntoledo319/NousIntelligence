{% extends 'aa/layout.html' %}

{% block aa_content %}
<div class="row">
    <div class="col-12 mb-4">
        <h1>AA Recovery Settings</h1>
        <p class="text-muted">Customize your recovery experience</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="aa-card">
            <div class="aa-card-title">Your Settings</div>
            
            <form action="{{ url_for('aa_routes.settings') }}" method="post">
                <!-- Contact Information -->
                <h5 class="mt-4 mb-3">Contact Information</h5>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="sponsor_name" class="form-label">Sponsor Name</label>
                        <input type="text" class="form-control" id="sponsor_name" name="sponsor_name" 
                            value="{{ settings.sponsor_name if settings else '' }}">
                    </div>
                    <div class="col-md-6">
                        <label for="sponsor_phone" class="form-label">Sponsor Phone</label>
                        <input type="tel" class="form-control" id="sponsor_phone" name="sponsor_phone" 
                            value="{{ settings.sponsor_phone if settings else '' }}">
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="backup_contact_name" class="form-label">Backup Contact Name</label>
                        <input type="text" class="form-control" id="backup_contact_name" name="backup_contact_name" 
                            value="{{ settings.backup_contact_name if settings else '' }}">
                    </div>
                    <div class="col-md-6">
                        <label for="backup_contact_phone" class="form-label">Backup Contact Phone</label>
                        <input type="tel" class="form-control" id="backup_contact_phone" name="backup_contact_phone" 
                            value="{{ settings.backup_contact_phone if settings else '' }}">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="home_group" class="form-label">Home Group</label>
                    <input type="text" class="form-control" id="home_group" name="home_group" 
                        value="{{ settings.home_group if settings else '' }}">
                </div>
                
                <!-- Recovery Information -->
                <h5 class="mt-4 mb-3">Recovery Information</h5>
                
                <div class="mb-3">
                    <label for="sober_date" class="form-label">Sober Date</label>
                    <input type="date" class="form-control" id="sober_date" name="sober_date" 
                        value="{{ settings.sober_date.strftime('%Y-%m-%d') if settings and settings.sober_date else '' }}">
                </div>
                
                <!-- Display Preferences -->
                <h5 class="mt-4 mb-3">Display Preferences</h5>
                
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="show_sober_days" name="show_sober_days" 
                        {% if settings and settings.show_sober_days %}checked{% endif %}>
                    <label class="form-check-label" for="show_sober_days">
                        Show days sober on dashboard
                    </label>
                </div>
                
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="track_honesty_streaks" name="track_honesty_streaks" 
                        {% if settings and settings.track_honesty_streaks %}checked{% endif %}>
                    <label class="form-check-label" for="track_honesty_streaks">
                        Track honesty streaks
                    </label>
                </div>
                
                <!-- Pain Flare Monitoring (Opt-in Only) -->
                <div class="card mb-3 bg-light">
                    <div class="card-body">
                        <h5 class="card-title">Optional Features</h5>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="track_pain_flares" name="track_pain_flares" 
                                {% if settings and settings.track_pain_flares %}checked{% endif %}>
                            <label class="form-check-label" for="track_pain_flares">
                                Enable pain flare monitoring based on weather
                            </label>
                            <div class="form-text text-muted">
                                This optional feature shows how weather conditions might affect pain levels. 
                                Only enabled if you explicitly opt-in.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notification Preferences -->
                <h5 class="mt-4 mb-3">Notification Preferences</h5>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="daily_reflection_time" class="form-label">Daily Reflection Time</label>
                        <input type="time" class="form-control" id="daily_reflection_time" name="daily_reflection_time" 
                            value="{{ settings.daily_reflection_time if settings else '07:00' }}">
                    </div>
                    <div class="col-md-6">
                        <label for="nightly_inventory_time" class="form-label">Nightly Inventory Time</label>
                        <input type="time" class="form-control" id="nightly_inventory_time" name="nightly_inventory_time" 
                            value="{{ settings.nightly_inventory_time if settings else '21:00' }}">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="spot_checks_per_day" class="form-label">Spot-Checks Per Day</label>
                    <select class="form-select" id="spot_checks_per_day" name="spot_checks_per_day">
                        <option value="0" {% if settings and settings.spot_checks_per_day == 0 %}selected{% endif %}>None</option>
                        <option value="1" {% if settings and settings.spot_checks_per_day == 1 %}selected{% endif %}>1 per day</option>
                        <option value="2" {% if settings and settings.spot_checks_per_day == 2 %}selected{% endif %}>2 per day</option>
                        <option value="3" {% if settings and settings.spot_checks_per_day == 3 %}selected{% endif %}>3 per day</option>
                        <option value="5" {% if settings and settings.spot_checks_per_day == 5 %}selected{% endif %}>5 per day</option>
                    </select>
                </div>
                
                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">Save Settings</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="aa-card">
            <div class="aa-card-title">About AA Recovery Tools</div>
            
            <p>These tools are designed to help support your recovery journey through the Alcoholics Anonymous program.</p>
            
            <h6 class="mt-3">Key Features:</h6>
            <ul>
                <li>Daily reflections from AA literature</li>
                <li>Nightly 10th step inventory</li>
                <li>Spot-check inventories throughout the day</li>
                <li>Meeting finder using the Meeting Guide API</li>
                <li>Sponsor contact and call logging</li>
                <li>Recovery statistics and achievements</li>
                <li>Mindfulness and coping tools</li>
                <li>Anonymous peer support forum</li>
            </ul>
            
            <h6 class="mt-3">Privacy Note:</h6>
            <p class="small text-muted">Your recovery information is private and protected. We recommend setting up a sponsor contact for accountability and support.</p>
        </div>
        
        <div class="aa-card mt-3">
            <div class="aa-card-title">Data & Privacy</div>
            
            <p>Your recovery journey is personal, and we respect your privacy.</p>
            
            <div class="d-grid gap-2">
                <a href="#" class="btn btn-outline-danger btn-sm">Reset All Recovery Data</a>
                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#exportDataModal">
                    Export Your Data
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Export Data Modal -->
<div class="modal fade" id="exportDataModal" tabindex="-1" aria-labelledby="exportDataModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportDataModalLabel">Export Your Recovery Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You can download a copy of all your recovery data in JSON format.</p>
                <p>This includes:</p>
                <ul>
                    <li>Recovery logs and journal entries</li>
                    <li>Meeting attendance records</li>
                    <li>Spot-check and inventory responses</li>
                    <li>Achievement records</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Download Data</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}