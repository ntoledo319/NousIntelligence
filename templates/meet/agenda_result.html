{% extends "layout.html" %}

{% block title %}Meeting Agenda{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">Generated Meeting Agenda</h1>
            
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('meet.dashboard') }}">Meet Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('meet.generate_agenda') }}">Generate Agenda</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Results</li>
                </ol>
            </nav>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        Agenda for
                        {% if result.meeting_info and result.meeting_info.title %}
                            {{ result.meeting_info.title }}
                        {% else %}
                            {{ result.meeting_type|capitalize }} Meeting
                        {% endif %}
                    </h5>
                    <span class="badge rounded-pill bg-primary">
                        {{ result.meeting_type|capitalize }}
                    </span>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        {% if result.meeting_info and result.meeting_info.start_time %}
                            <p class="text-muted">
                                <i class="far fa-calendar-alt me-2"></i>
                                {{ result.meeting_info.start_time|replace('T', ' ')|replace('Z', '')|replace('.000', '') }}
                            </p>
                        {% endif %}
                    </div>
                    
                    <div class="agenda-content bg-light p-4 rounded mb-4" id="agenda-content">
                        <pre class="mb-0" style="white-space: pre-wrap;">{{ result.agenda }}</pre>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-outline-primary" onclick="copyToClipboard()">
                            <i class="far fa-copy me-1"></i> Copy
                        </button>
                        <button class="btn btn-outline-primary" onclick="downloadPDF()">
                            <i class="far fa-file-pdf me-1"></i> PDF
                        </button>
                        <button class="btn btn-outline-primary" onclick="downloadWord()">
                            <i class="far fa-file-word me-1"></i> Word
                        </button>
                        <button class="btn btn-primary" onclick="useAgenda()">
                            <i class="fas fa-check me-1"></i> Use Agenda
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Meeting Information</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>Meeting Type:</strong> {{ result.meeting_type|capitalize }}
                        </li>
                        {% if result.meeting_info and result.meeting_info.title %}
                            <li class="list-group-item">
                                <strong>Title:</strong> {{ result.meeting_info.title }}
                            </li>
                        {% endif %}
                        {% if result.meeting_info and result.meeting_info.start_time %}
                            <li class="list-group-item">
                                <strong>Date:</strong> {{ result.meeting_info.start_time|replace('T', ' ')|replace('Z', '')|replace('.000', '') }}
                            </li>
                        {% endif %}
                        {% if result.meeting_info and result.meeting_info.attendees %}
                            <li class="list-group-item">
                                <strong>Attendees:</strong> {{ result.meeting_info.attendees|length }}
                            </li>
                        {% endif %}
                    </ul>
                    
                    {% if result.meeting_info and result.meeting_info.meeting_id %}
                        <div class="mt-3">
                            <a href="{{ url_for('meet.view', meeting_id=result.meeting_info.meeting_id) }}" class="btn btn-outline-primary btn-sm w-100">
                                <i class="fas fa-eye me-1"></i> View Meeting
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Next Steps</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-success" onclick="prepareForMeeting()">
                            <i class="fas fa-tasks me-1"></i> Prepare for Meeting
                        </button>
                        <a href="{{ url_for('meet.generate_agenda') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-redo me-1"></i> Generate New Agenda
                        </a>
                        <a href="{{ url_for('meet.dashboard') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-th-large me-1"></i> Return to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    function copyToClipboard() {
        const agenda = document.querySelector("#agenda-content pre").textContent;
        navigator.clipboard.writeText(agenda).then(function() {
            alert("Agenda copied to clipboard!");
        }, function(err) {
            console.error('Could not copy text: ', err);
        });
    }
    
    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        let meetingTitle = "Meeting Agenda";
        let meetingTime = "";
        
        if (meetingTitle && meetingTitle !== "Meeting Agenda") {
            doc.setFontSize(16);
            doc.text(meetingTitle, 20, 20);
            doc.setFontSize(10);
            if (meetingTime) {
                doc.text(meetingTime, 20, 30);
            }
            doc.setFontSize(12);
            const agenda = document.querySelector("#agenda-content pre").textContent;
            const splitText = doc.splitTextToSize(agenda, 170);
            doc.text(splitText, 20, 40);
        } else {
            doc.setFontSize(16);
            doc.text("Meeting Agenda", 20, 20);
            doc.setFontSize(12);
            const agenda = document.querySelector("#agenda-content pre").textContent;
            const splitText = doc.splitTextToSize(agenda, 170);
            doc.text(splitText, 20, 30);
        }
        
        doc.save("meeting_agenda.pdf");
    }
    
    function downloadWord() {
        let meetingTitle = "Meeting Agenda";
        let meetingTime = "";
        
        // Prepare content with proper formatting for Word
        let htmlContent = '<!DOCTYPE html><html><head><style>';
        htmlContent += 'body { font-family: Arial, sans-serif; margin: 40px; }';
        htmlContent += 'h1 { color: #333366; }';
        htmlContent += '.date { color: #666666; margin-bottom: 20px; }';
        htmlContent += '.agenda { white-space: pre-wrap; }';
        htmlContent += '</style></head><body>';
        htmlContent += '<h1>' + meetingTitle + '</h1>';
        
        if (meetingTime) {
            htmlContent += '<p class="date">' + meetingTime + '</p>';
        }
        
        htmlContent += '<div class="agenda">' + document.querySelector("#agenda-content pre").textContent + '</div>';
        htmlContent += '</body></html>';
        
        // Create a Blob and download
        const blob = new Blob([htmlContent], { type: 'application/msword' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = "meeting_agenda.doc";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    function useAgenda() {
        // If we have a meeting, update its description to include the agenda
        if (confirm('Would you like to add this agenda to the meeting description?')) {
            // This would typically call an API endpoint to update the meeting
            alert('Agenda added to meeting description!');
        } else {
            alert('Agenda saved! You can access it from the Saved Agendas section.');
        }
    }
    
    function prepareForMeeting() {
        if (confirm('Would you like to create a meeting notes document based on this agenda?')) {
            // This would typically create a notes document
            alert('Meeting notes document created! You can access it from Google Docs.');
        }
    }
</script>
{% endblock %} 