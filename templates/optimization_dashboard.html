<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOUS Optimization Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/chart.js"></script>
    <style>
        .optimization-card {
            transition: all 0.3s ease;
        }
        .optimization-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-good { background-color: #10b981; }
        .status-warning { background-color: #f59e0b; }
        .status-critical { background-color: #ef4444; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">NOUS Optimization Dashboard</h1>
                    <span class="ml-3 px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        Active
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="refreshBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        Refresh Data
                    </button>
                    <button id="runOptimizationBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        Run Optimization
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- System Health Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="optimization-card bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">CPU Usage</p>
                        <p class="text-2xl font-semibold text-gray-900" id="cpuUsage">Loading...</p>
                    </div>
                </div>
            </div>

            <div class="optimization-card bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Memory Usage</p>
                        <p class="text-2xl font-semibold text-gray-900" id="memoryUsage">Loading...</p>
                    </div>
                </div>
            </div>

            <div class="optimization-card bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Cost Savings</p>
                        <p class="text-2xl font-semibold text-gray-900" id="costSavings">Loading...</p>
                    </div>
                </div>
            </div>

            <div class="optimization-card bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Overall Score</p>
                        <p class="text-2xl font-semibold text-gray-900" id="overallScore">Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Optimization Modules -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Active Optimization Modules</h3>
                </div>
                <div class="p-6">
                    <div id="optimizationModules" class="space-y-4">
                        <!-- Modules will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Optimization Recommendations</h3>
                </div>
                <div class="p-6">
                    <div id="recommendations" class="space-y-3">
                        <!-- Recommendations will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Performance Metrics</h3>
            </div>
            <div class="p-6">
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Recent Optimizations -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Recent Optimizations</h3>
            </div>
            <div class="p-6">
                <div id="recentOptimizations" class="space-y-4">
                    <!-- Recent optimizations will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100">
                    <svg class="animate-spin h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Running Optimization</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500" id="loadingMessage">Please wait while we optimize your system...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let performanceChart;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeChart();
            
            // Set up auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
        });

        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
            loadDashboardData();
        });

        // Run optimization button
        document.getElementById('runOptimizationBtn').addEventListener('click', function() {
            runOptimization();
        });

        async function loadDashboardData() {
            try {
                // Load system health
                const healthResponse = await fetch('/api/optimization/system-health');
                const healthData = await healthResponse.json();
                
                if (healthData.status === 'success') {
                    updateSystemHealth(healthData.data);
                }

                // Load optimization modules
                const modulesResponse = await fetch('/api/optimization/modules');
                const modulesData = await modulesResponse.json();
                
                if (modulesData.status === 'success') {
                    updateOptimizationModules(modulesData.data.modules);
                }

                // Load recommendations
                const recsResponse = await fetch('/api/optimization/recommendations');
                const recsData = await recsResponse.json();
                
                if (recsData.status === 'success') {
                    updateRecommendations(recsData.data.recommendations);
                }

                // Load performance metrics
                const metricsResponse = await fetch('/api/optimization/performance-metrics');
                const metricsData = await metricsResponse.json();
                
                if (metricsData.status === 'success') {
                    updatePerformanceChart(metricsData.data);
                }

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function updateSystemHealth(healthData) {
            const metrics = healthData.metrics;
            const status = healthData.status;

            document.getElementById('cpuUsage').textContent = `${metrics.cpu_percent.toFixed(1)}%`;
            document.getElementById('memoryUsage').textContent = `${metrics.memory_percent.toFixed(1)}%`;
            
            // Update cost savings (placeholder)
            document.getElementById('costSavings').textContent = '25-35%';
            
            // Update overall score (placeholder)
            document.getElementById('overallScore').textContent = '92/100';
        }

        function updateOptimizationModules(modules) {
            const container = document.getElementById('optimizationModules');
            container.innerHTML = '';

            modules.forEach(module => {
                const moduleElement = document.createElement('div');
                moduleElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                
                moduleElement.innerHTML = `
                    <div class="flex items-center">
                        <span class="status-indicator status-good"></span>
                        <span class="font-medium text-gray-900">${module.name}</span>
                    </div>
                    <span class="text-sm text-gray-500">${module.status}</span>
                `;
                
                container.appendChild(moduleElement);
            });
        }

        function updateRecommendations(recommendations) {
            const container = document.getElementById('recommendations');
            container.innerHTML = '';

            if (recommendations.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No recommendations available</p>';
                return;
            }

            recommendations.forEach(rec => {
                const recElement = document.createElement('div');
                recElement.className = 'p-3 bg-blue-50 border border-blue-200 rounded-lg';
                
                const priorityColor = rec.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                    rec.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-green-100 text-green-800';
                
                recElement.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900">${rec.recommendation}</p>
                            <span class="inline-block mt-1 px-2 py-1 text-xs font-medium rounded ${priorityColor}">
                                ${rec.priority} priority
                            </span>
                        </div>
                    </div>
                `;
                
                container.appendChild(recElement);
            });
        }

        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage %',
                        data: [],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'Memory Usage %',
                        data: [],
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function updatePerformanceChart(metricsData) {
            // Update chart with actual metrics data
            const currentTime = new Date().toLocaleTimeString();
            const systemHealth = metricsData.system_health;
            
            if (performanceChart.data.labels.length > 20) {
                performanceChart.data.labels.shift();
                performanceChart.data.datasets.forEach(dataset => dataset.data.shift());
            }
            
            performanceChart.data.labels.push(currentTime);
            performanceChart.data.datasets[0].data.push(systemHealth.cpu_percent);
            performanceChart.data.datasets[1].data.push(systemHealth.memory_percent);
            
            performanceChart.update();
        }

        async function runOptimization() {
            const modal = document.getElementById('loadingModal');
            const messageElement = document.getElementById('loadingMessage');
            
            modal.classList.remove('hidden');
            
            try {
                messageElement.textContent = 'Running comprehensive optimization...';
                
                const response = await fetch('/api/optimization/run', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        level: 'standard'
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    messageElement.textContent = 'Optimization completed successfully!';
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        loadDashboardData();
                    }, 2000);
                } else {
                    throw new Error(data.message || 'Optimization failed');
                }
                
            } catch (error) {
                console.error('Optimization error:', error);
                messageElement.textContent = 'Optimization failed. Please try again.';
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 3000);
            }
        }
    </script>
</body>
</html>