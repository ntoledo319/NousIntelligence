<!DOCTYPE html>
<html lang="en" data-theme="limen-harbor">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NOUS Chat - AI Personal Assistant with Limen Harbor theme">
    <meta name="theme-color" content="#0891b2">
    <title>NOUS Chat - AI Personal Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body class="bg-harbor">
    <div class="chat-app">
        <header class="app-header" style="background: var(--hero-gradient); color: var(--text-inverse);">
            <div class="header-content" style="max-width: 800px; margin: 0 auto; padding: 1.25rem;">
                <h1 style="font-size: 1.5rem; font-weight: 600; margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                    ðŸ§  NOUS Chat
                </h1>
                <p style="opacity: 0.9; font-size: 0.875rem; margin: 0;">Your intelligent personal assistant</p>
                {% if demo_mode or (user and user.demo_mode) %}
                <span style="background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; display: inline-block; margin-top: 0.5rem;">
                    ðŸ“š Demo Mode
                </span>
                {% endif %}
            </div>
        </header>
        
        <div class="chat-messages" id="chatMessages" style="flex: 1; padding: 1.25rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; background: var(--background-color);">
            <div class="welcome-message" style="text-align: center; color: var(--text-secondary); padding: 1.5rem; background: var(--surface-color); border-radius: var(--border-radius); border: 1px solid var(--border-color);">
                <p style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">ðŸ‘‹ Welcome to NOUS!</p>
                <p style="margin: 0 0 0.5rem 0;">I'm your AI personal assistant, here to help.</p>
                <p style="margin: 0;">Ask me anything or try saying hello!</p>
                {% if demo_mode or (user and user.demo_mode) %}
                <p style="margin-top: 1rem; font-style: italic; opacity: 0.8; font-size: 0.9rem;">
                    You're using the demo version. Full features will be available with proper setup.
                </p>
                {% endif %}
            </div>
        </div>
        
        <div class="chat-input-container" style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; gap: 0.75rem; background: var(--surface-color);">
            <input 
                type="text" 
                id="chatInput" 
                placeholder="Type your message..." 
                autofocus
                style="flex: 1; padding: 0.875rem 1rem; border: 2px solid var(--border-color); border-radius: 2rem; font-size: 1rem; outline: none; transition: border-color var(--transition-normal); background: var(--background-color); color: var(--text-primary);"
            >
            <button 
                id="sendButton" 
                class="btn-primary"
                style="padding: 0.875rem 1.5rem; border-radius: 2rem; font-weight: 500; min-width: 80px;"
            >
                Send
            </button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                max-width: 80%;
                padding: 0.875rem 1.25rem;
                border-radius: 1.25rem;
                font-size: 0.95rem;
                line-height: 1.5;
                animation: fadeIn 0.3s ease-out;
                ${isUser ? 
                    'background: var(--button-gradient); color: var(--text-inverse); align-self: flex-end; margin-left: auto; border-bottom-right-radius: 0.25rem;' : 
                    'background: var(--surface-color); color: var(--text-primary); align-self: flex-start; border: 1px solid var(--border-color); border-bottom-left-radius: 0.25rem;'
                }
            `;
            messageDiv.textContent = content;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            sendButton.disabled = true;
            sendButton.textContent = '...';
            
            try {
                const response = await fetch('/api/v1/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addMessage(data.response || "I'm processing your request...");
                } else {
                    addMessage("Sorry, I'm having trouble connecting right now. Please try again.");
                }
            } catch (error) {
                addMessage("Sorry, I'm having trouble connecting right now. Please try again.");
            }
            
            sendButton.disabled = false;
            sendButton.textContent = 'Send';
            chatInput.focus();
        }
        
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Focus styling for input
        chatInput.addEventListener('focus', function() {
            this.style.borderColor = 'var(--brand)';
            this.style.boxShadow = '0 0 0 3px rgba(8, 145, 178, 0.15)';
        });
        chatInput.addEventListener('blur', function() {
            this.style.borderColor = 'var(--border-color)';
            this.style.boxShadow = 'none';
        });
        
        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .chat-app {
                height: 100vh;
                display: flex;
                flex-direction: column;
                max-width: 900px;
                margin: 0 auto;
                background: var(--surface-color);
                box-shadow: 0 0 40px var(--shadow-color);
            }
            @media (max-width: 600px) {
                .chat-app {
                    max-width: 100%;
                    box-shadow: none;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
