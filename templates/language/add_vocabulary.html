{% extends "base.html" %}

{% block title %}Add Vocabulary | {{ profile.language_name }} | NOUS{% endblock %}

{% block styles %}
<style>
    .translation-result {
        transition: all 0.3s ease;
    }
    .pronunciation-box {
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        padding: 1rem;
    }
    .auto-fetch-card {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .auto-fetch-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('language.index') }}">Language Learning</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('language.profile', profile_id=profile.profile.id) }}">{{ profile.language_name }}</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('language.vocabulary', profile_id=profile.profile.id) }}">Vocabulary</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Add Words</li>
                </ol>
            </nav>
            
            <h1 class="mb-4">Add New {{ profile.language_name }} Vocabulary</h1>
            
            {% include "partials/flash_messages.html" %}
        </div>
    </div>
    
    <div class="row">
        <!-- Vocabulary Form -->
        <div class="col-md-7">
            <div class="card mb-4">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="addMethodTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual" type="button" role="tab" aria-controls="manual" aria-selected="true">Manual Entry</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="translation-tab" data-bs-toggle="tab" data-bs-target="#translation" type="button" role="tab" aria-controls="translation" aria-selected="false">From Translation</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="batch-tab" data-bs-toggle="tab" data-bs-target="#batch" type="button" role="tab" aria-controls="batch" aria-selected="false">Batch Import</button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="addMethodTabsContent">
                        <!-- Manual Entry Tab -->
                        <div class="tab-pane fade show active" id="manual" role="tabpanel" aria-labelledby="manual-tab">
                            <form method="POST" action="{{ url_for('language.add_vocabulary', profile_id=profile.profile.id) }}" id="addVocabularyForm">
                                <div class="mb-3">
                                    <label for="word" class="form-label">Word or Phrase ({{ profile.language_name }})</label>
                                    <input type="text" class="form-control" id="word" name="word" required value="{{ request.args.get('word', '') }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="translation" class="form-label">Translation ({{ profile.native_language_name }})</label>
                                    <input type="text" class="form-control" id="translation" name="translation" required value="{{ request.args.get('translation', '') }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pronunciation" class="form-label">Pronunciation Guide</label>
                                    <input type="text" class="form-control" id="pronunciation" name="pronunciation" value="{{ request.args.get('pronunciation', '') }}">
                                    <div class="form-text">How to pronounce this word (phonetic spelling)</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="part_of_speech" class="form-label">Part of Speech</label>
                                    <select class="form-select" id="part_of_speech" name="part_of_speech">
                                        <option value="" selected>-- Select --</option>
                                        <option value="noun">Noun</option>
                                        <option value="verb">Verb</option>
                                        <option value="adjective">Adjective</option>
                                        <option value="adverb">Adverb</option>
                                        <option value="preposition">Preposition</option>
                                        <option value="conjunction">Conjunction</option>
                                        <option value="pronoun">Pronoun</option>
                                        <option value="interjection">Interjection</option>
                                        <option value="phrase">Phrase</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="example" class="form-label">Example Sentence</label>
                                    <textarea class="form-control" id="example" name="example" rows="2"></textarea>
                                    <div class="form-text">An example sentence using this word/phrase</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="notes" class="form-label">Personal Notes</label>
                                    <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                                    <div class="form-text">Any personal notes or memory aids</div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-primary" id="fetchPronunciation">
                                        <i class="fas fa-magic"></i> Auto-Fill Pronunciation
                                    </button>
                                    <button type="button" class="btn btn-outline-success" id="generateExamples">
                                        <i class="fas fa-lightbulb"></i> Generate Examples
                                    </button>
                                </div>
                                
                                <div class="mt-4 text-end">
                                    <a href="{{ url_for('language.vocabulary', profile_id=profile.profile.id) }}" class="btn btn-outline-secondary me-2">Cancel</a>
                                    <button type="submit" class="btn btn-primary">Add Vocabulary</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Translation Tab -->
                        <div class="tab-pane fade" id="translation" role="tabpanel" aria-labelledby="translation-tab">
                            <div class="mb-3">
                                <label for="translateSource" class="form-label">Translate From</label>
                                <select class="form-select" id="translateSource">
                                    <option value="{{ profile.profile.native_language }}" selected>{{ profile.native_language_name }}</option>
                                    <option value="{{ profile.profile.learning_language }}">{{ profile.language_name }}</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="translateText" class="form-label">Text to Translate</label>
                                <textarea class="form-control" id="translateText" rows="3" placeholder="Enter text to translate..."></textarea>
                            </div>
                            
                            <div class="text-end mb-3">
                                <button type="button" id="swapBtn" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-exchange-alt"></i> Swap
                                </button>
                                <button type="submit" id="translateBtn" class="btn btn-primary">Translate</button>
                            </div>
                            
                            <div id="translationResults" class="d-none mt-4">
                                <h5>Translation Results</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <p id="translatedText"></p>
                                        
                                        <div id="pronunciationSection" class="mt-3 pronunciation-box d-none">
                                            <h6>Pronunciation</h6>
                                            <p id="pronunciationText" class="fst-italic mb-2"></p>
                                            <button id="playPronunciationBtn" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-volume-up"></i> Listen
                                            </button>
                                        </div>
                                        
                                        <div id="translationNotes" class="mt-3 d-none">
                                            <h6>Notes</h6>
                                            <p id="notesText" class="small"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-end mt-3">
                                    <button type="button" id="addTranslationToVocab" class="btn btn-success">
                                        <i class="fas fa-plus"></i> Add to Vocabulary
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Batch Import Tab -->
                        <div class="tab-pane fade" id="batch" role="tabpanel" aria-labelledby="batch-tab">
                            <p>Add multiple vocabulary items at once using CSV format or line by line.</p>
                            
                            <div class="mb-3">
                                <label for="batchFormat" class="form-label">Format</label>
                                <select class="form-select" id="batchFormat">
                                    <option value="basic" selected>Basic (Word, Translation)</option>
                                    <option value="extended">Extended (Word, Translation, Pronunciation, Part of Speech)</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="batchData" class="form-label">Batch Data</label>
                                <textarea class="form-control font-monospace" id="batchData" rows="10" placeholder="hola, hello&#10;gracias, thank you&#10;por favor, please"></textarea>
                                <div class="form-text">
                                    <span id="basicFormatHelp">Enter one item per line, with word and translation separated by comma.</span>
                                    <span id="extendedFormatHelp" class="d-none">Enter one item per line, with values separated by commas: word, translation, pronunciation, part_of_speech</span>
                                </div>
                            </div>
                            
                            <div class="alert alert-info" role="alert">
                                <i class="fas fa-info-circle"></i> Batch import will create vocabulary items directly. Make sure your format is correct.
                            </div>
                            
                            <div class="mt-3 text-end">
                                <button type="button" id="importBatchBtn" class="btn btn-primary">Import Words</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Suggestions and Help -->
        <div class="col-md-5">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Common {{ profile.language_name }} Words</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Click on a word to add it to your vocabulary</p>
                    
                    <div class="row">
                        {% if profile.profile.learning_language == 'es-ES' %}
                            <!-- Common Spanish Words -->
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="hola" data-translation="hello">
                                    <div class="card-body">
                                        <h5>hola</h5>
                                        <p class="text-muted">hello</p>
                                        <span class="badge bg-secondary">Greeting</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="gracias" data-translation="thank you">
                                    <div class="card-body">
                                        <h5>gracias</h5>
                                        <p class="text-muted">thank you</p>
                                        <span class="badge bg-secondary">Expression</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="por favor" data-translation="please">
                                    <div class="card-body">
                                        <h5>por favor</h5>
                                        <p class="text-muted">please</p>
                                        <span class="badge bg-secondary">Expression</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="buenos días" data-translation="good morning">
                                    <div class="card-body">
                                        <h5>buenos días</h5>
                                        <p class="text-muted">good morning</p>
                                        <span class="badge bg-secondary">Greeting</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="cómo estás" data-translation="how are you">
                                    <div class="card-body">
                                        <h5>cómo estás</h5>
                                        <p class="text-muted">how are you</p>
                                        <span class="badge bg-secondary">Question</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="adiós" data-translation="goodbye">
                                    <div class="card-body">
                                        <h5>adiós</h5>
                                        <p class="text-muted">goodbye</p>
                                        <span class="badge bg-secondary">Greeting</span>
                                    </div>
                                </div>
                            </div>
                        {% elif profile.profile.learning_language == 'fr-FR' %}
                            <!-- Common French Words -->
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="bonjour" data-translation="hello">
                                    <div class="card-body">
                                        <h5>bonjour</h5>
                                        <p class="text-muted">hello</p>
                                        <span class="badge bg-secondary">Greeting</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="merci" data-translation="thank you">
                                    <div class="card-body">
                                        <h5>merci</h5>
                                        <p class="text-muted">thank you</p>
                                        <span class="badge bg-secondary">Expression</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="s'il vous plaît" data-translation="please">
                                    <div class="card-body">
                                        <h5>s'il vous plaît</h5>
                                        <p class="text-muted">please</p>
                                        <span class="badge bg-secondary">Expression</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="comment allez-vous" data-translation="how are you">
                                    <div class="card-body">
                                        <h5>comment allez-vous</h5>
                                        <p class="text-muted">how are you</p>
                                        <span class="badge bg-secondary">Question</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="au revoir" data-translation="goodbye">
                                    <div class="card-body">
                                        <h5>au revoir</h5>
                                        <p class="text-muted">goodbye</p>
                                        <span class="badge bg-secondary">Greeting</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="auto-fetch-card card h-100" data-word="enchanté" data-translation="pleased to meet you">
                                    <div class="card-body">
                                        <h5>enchanté</h5>
                                        <p class="text-muted">pleased to meet you</p>
                                        <span class="badge bg-secondary">Greeting</span>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-4">
                                <p>Common words for {{ profile.language_name }} will appear here</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Tips for Learning Vocabulary</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Add context</strong> - Words with example sentences are easier to remember
                        </li>
                        <li class="list-group-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Learn in categories</strong> - Group related words together
                        </li>
                        <li class="list-group-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Practice pronunciation</strong> - Say words out loud and listen to native speakers
                        </li>
                        <li class="list-group-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Review regularly</strong> - Use the practice feature to review words using spaced repetition
                        </li>
                        <li class="list-group-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Create associations</strong> - Connect new words to images or memories
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Format toggle for batch import
        const batchFormat = document.getElementById('batchFormat');
        const basicFormatHelp = document.getElementById('basicFormatHelp');
        const extendedFormatHelp = document.getElementById('extendedFormatHelp');
        
        batchFormat.addEventListener('change', function() {
            if (this.value === 'basic') {
                basicFormatHelp.classList.remove('d-none');
                extendedFormatHelp.classList.add('d-none');
            } else {
                basicFormatHelp.classList.add('d-none');
                extendedFormatHelp.classList.remove('d-none');
            }
        });
        
        // Auto-fill from suggestion cards
        const suggestionCards = document.querySelectorAll('.auto-fetch-card');
        
        suggestionCards.forEach(card => {
            card.addEventListener('click', function() {
                const word = this.getAttribute('data-word');
                const translation = this.getAttribute('data-translation');
                
                // Switch to manual tab
                document.getElementById('manual-tab').click();
                
                // Fill the form
                document.getElementById('word').value = word;
                document.getElementById('translation').value = translation;
                
                // Fetch pronunciation
                document.getElementById('fetchPronunciation').click();
            });
        });
        
        // Fetch pronunciation
        const fetchPronunciationBtn = document.getElementById('fetchPronunciation');
        
        fetchPronunciationBtn.addEventListener('click', function() {
            const word = document.getElementById('word').value;
            
            if (!word) {
                alert('Please enter a word first');
                return;
            }
            
            // Show loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Fetching...';
            this.disabled = true;
            
            // This would be replaced with actual API call
            setTimeout(() => {
                // Simulate API response
                let pronunciation = '';
                
                if ('{{ profile.profile.learning_language }}'.startsWith('es')) {
                    if (word === 'hola') pronunciation = 'OH-lah';
                    else if (word === 'gracias') pronunciation = 'GRAH-see-ahs';
                    else if (word === 'por favor') pronunciation = 'por fah-VOR';
                    else if (word === 'buenos días') pronunciation = 'BWEH-nohs DEE-ahs';
                    else pronunciation = word.split('').join('-');
                } else if ('{{ profile.profile.learning_language }}'.startsWith('fr')) {
                    if (word === 'bonjour') pronunciation = 'bon-ZHOOR';
                    else if (word === 'merci') pronunciation = 'mehr-SEE';
                    else if (word === 's\'il vous plaît') pronunciation = 'seel voo PLEH';
                    else pronunciation = word.split('').join('-');
                }
                
                // Fill pronunciation field
                document.getElementById('pronunciation').value = pronunciation;
                
                // Reset button
                this.innerHTML = '<i class="fas fa-magic"></i> Auto-Fill Pronunciation';
                this.disabled = false;
            }, 1000);
        });
        
        // Generate examples
        const generateExamplesBtn = document.getElementById('generateExamples');
        
        generateExamplesBtn.addEventListener('click', function() {
            const word = document.getElementById('word').value;
            
            if (!word) {
                alert('Please enter a word first');
                return;
            }
            
            // Show loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            this.disabled = true;
            
            // This would be replaced with actual API call
            setTimeout(() => {
                // Simulate API response
                let example = '';
                
                if ('{{ profile.profile.learning_language }}'.startsWith('es')) {
                    if (word === 'hola') {
                        example = '¡Hola! ¿Cómo estás hoy?';
                    } else if (word === 'gracias') {
                        example = 'Muchas gracias por tu ayuda.';
                    } else if (word === 'por favor') {
                        example = 'Por favor, ¿puedes ayudarme?';
                    } else {
                        example = `Este es un ejemplo con la palabra "${word}".`;
                    }
                } else if ('{{ profile.profile.learning_language }}'.startsWith('fr')) {
                    if (word === 'bonjour') {
                        example = 'Bonjour! Comment allez-vous aujourd\'hui?';
                    } else if (word === 'merci') {
                        example = 'Merci beaucoup pour votre aide.';
                    } else if (word === 's\'il vous plaît') {
                        example = 'Pouvez-vous m\'aider, s\'il vous plaît?';
                    } else {
                        example = `C'est un exemple avec le mot "${word}".`;
                    }
                }
                
                // Fill example field
                document.getElementById('example').value = example;
                
                // Reset button
                this.innerHTML = '<i class="fas fa-lightbulb"></i> Generate Examples';
                this.disabled = false;
            }, 1500);
        });
        
        // Translation functionality
        const translateBtn = document.getElementById('translateBtn');
        const translateText = document.getElementById('translateText');
        const translateSource = document.getElementById('translateSource');
        const translationResults = document.getElementById('translationResults');
        const translatedText = document.getElementById('translatedText');
        const pronunciationSection = document.getElementById('pronunciationSection');
        const pronunciationText = document.getElementById('pronunciationText');
        const translationNotes = document.getElementById('translationNotes');
        const notesText = document.getElementById('notesText');
        const swapBtn = document.getElementById('swapBtn');
        
        translateBtn.addEventListener('click', function() {
            if (!translateText.value) {
                alert('Please enter text to translate');
                return;
            }
            
            // Show loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Translating...';
            this.disabled = true;
            
            // This would be replaced with actual API call
            setTimeout(() => {
                // Show results
                translationResults.classList.remove('d-none');
                
                // Simulate API response
                let translation = '';
                let pronunciation = '';
                let notes = '';
                
                const isFromNative = translateSource.value.includes('{{ profile.profile.native_language }}');
                
                if (isFromNative) {
                    // Translate to target language
                    if ('{{ profile.profile.learning_language }}'.startsWith('es')) {
                        if (translateText.value.toLowerCase().includes('hello')) {
                            translation = '¡Hola!';
                            pronunciation = 'OH-lah';
                            notes = 'A common greeting in Spanish used throughout the day.';
                        } else if (translateText.value.toLowerCase().includes('thank you')) {
                            translation = 'Gracias';
                            pronunciation = 'GRAH-see-ahs';
                            notes = 'For extra emphasis, you can say "muchas gracias" (thank you very much).';
                        } else {
                            translation = 'Este es un texto en español.';
                            pronunciation = 'EHS-teh ehs oon TEHKS-toh ehn ehs-pahn-YOHL';
                            notes = 'This is a placeholder translation. For more accurate results, try specific words or phrases.';
                        }
                    } else if ('{{ profile.profile.learning_language }}'.startsWith('fr')) {
                        if (translateText.value.toLowerCase().includes('hello')) {
                            translation = 'Bonjour!';
                            pronunciation = 'bon-ZHOOR';
                            notes = 'Used during the day. In the evening, use "Bonsoir" instead.';
                        } else if (translateText.value.toLowerCase().includes('thank you')) {
                            translation = 'Merci';
                            pronunciation = 'mehr-SEE';
                            notes = 'For extra emphasis, you can say "merci beaucoup" (thank you very much).';
                        } else {
                            translation = 'C\'est un texte en français.';
                            pronunciation = 'seh uhn tekst ahn frahn-SEH';
                            notes = 'This is a placeholder translation. For more accurate results, try specific words or phrases.';
                        }
                    }
                    
                    // Show pronunciation for target language
                    pronunciationSection.classList.remove('d-none');
                } else {
                    // Translate to native language
                    if ('{{ profile.profile.learning_language }}'.startsWith('es')) {
                        if (translateText.value.toLowerCase().includes('hola')) {
                            translation = 'Hello';
                            notes = 'A common greeting in English used throughout the day.';
                        } else if (translateText.value.toLowerCase().includes('gracias')) {
                            translation = 'Thank you';
                            notes = 'A polite expression of gratitude.';
                        } else {
                            translation = 'This is a text in English.';
                            notes = 'This is a placeholder translation. For more accurate results, try specific words or phrases.';
                        }
                    } else if ('{{ profile.profile.learning_language }}'.startsWith('fr')) {
                        if (translateText.value.toLowerCase().includes('bonjour')) {
                            translation = 'Hello';
                            notes = 'A common greeting in English used throughout the day.';
                        } else if (translateText.value.toLowerCase().includes('merci')) {
                            translation = 'Thank you';
                            notes = 'A polite expression of gratitude.';
                        } else {
                            translation = 'This is a text in English.';
                            notes = 'This is a placeholder translation. For more accurate results, try specific words or phrases.';
                        }
                    }
                    
                    // Hide pronunciation for native language
                    pronunciationSection.classList.add('d-none');
                }
                
                // Fill in results
                translatedText.textContent = translation;
                pronunciationText.textContent = pronunciation;
                
                if (notes) {
                    translationNotes.classList.remove('d-none');
                    notesText.textContent = notes;
                } else {
                    translationNotes.classList.add('d-none');
                }
                
                // Reset button
                this.innerHTML = 'Translate';
                this.disabled = false;
            }, 1500);
        });
        
        // Swap translation direction
        swapBtn.addEventListener('click', function() {
            const currentSource = translateSource.value;
            translateSource.value = currentSource.includes('{{ profile.profile.native_language }}') ? 
                '{{ profile.profile.learning_language }}' : '{{ profile.profile.native_language }}';
            
            // Hide results when swapping
            translationResults.classList.add('d-none');
        });
        
        // Add translation to vocabulary
        const addTranslationToVocabBtn = document.getElementById('addTranslationToVocab');
        
        addTranslationToVocabBtn.addEventListener('click', function() {
            const isFromNative = translateSource.value.includes('{{ profile.profile.native_language }}');
            
            // Get word and translation based on direction
            let word, translation;
            
            if (isFromNative) {
                word = translatedText.textContent;
                translation = translateText.value;
            } else {
                word = translateText.value;
                translation = translatedText.textContent;
            }
            
            // Switch to manual tab
            document.getElementById('manual-tab').click();
            
            // Fill the form
            document.getElementById('word').value = word;
            document.getElementById('translation').value = translation;
            document.getElementById('pronunciation').value = isFromNative ? pronunciationText.textContent : '';
        });
        
        // Import batch vocabulary
        const importBatchBtn = document.getElementById('importBatchBtn');
        
        importBatchBtn.addEventListener('click', function() {
            const batchData = document.getElementById('batchData').value;
            const format = document.getElementById('batchFormat').value;
            
            if (!batchData.trim()) {
                alert('Please enter batch data');
                return;
            }
            
            // Show loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Importing...';
            this.disabled = true;
            
            // Parse batch data
            const lines = batchData.trim().split('\n');
            let items = [];
            
            try {
                if (format === 'basic') {
                    items = lines.map(line => {
                        const [word, translation] = line.split(',').map(s => s.trim());
                        return { word, translation };
                    });
                } else {
                    items = lines.map(line => {
                        const [word, translation, pronunciation, partOfSpeech] = line.split(',').map(s => s.trim());
                        return { word, translation, pronunciation, partOfSpeech };
                    });
                }
                
                // This would be replaced with actual API call
                setTimeout(() => {
                    // Show success message
                    alert(`Successfully imported ${items.length} vocabulary items!`);
                    
                    // Reset form
                    document.getElementById('batchData').value = '';
                    
                    // Reset button
                    this.innerHTML = 'Import Words';
                    this.disabled = false;
                    
                    // Redirect to vocabulary list
                    window.location.href = '{{ url_for("language.vocabulary", profile_id=profile.profile.id) }}';
                }, 1500);
            } catch (error) {
                alert('Error parsing batch data. Please check the format and try again.');
                this.innerHTML = 'Import Words';
                this.disabled = false;
            }
        });
        
        // Pronunciation playback
        const playPronunciationBtn = document.getElementById('playPronunciationBtn');
        
        playPronunciationBtn.addEventListener('click', function() {
            // This would be replaced with actual audio playback
            alert('Playing pronunciation...');
        });
    });
</script>
{% endblock %}